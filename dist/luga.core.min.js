/*! Luga Core 0.4.0 2015-09-24 07:09
Copyright 2013-15 Massimo Foti (massimo@massimocorner.com) 
Licensed under the Apache License, Version 2.0 | http://www.apache.org/licenses/LICENSE-2.0 
*/  
if("undefined"==typeof jQuery)throw"Unable to find jQuery";if("undefined"==typeof luga)var luga={};!function(){"use strict";luga.version="0.4.0",luga.CONST={ERROR_MESSAGES:{NOTIFIER_ABSTRACT:"It's forbidden to use luga.Notifier directly, it must be used as a base class instead",INVALID_OBSERVER_PARAMETER:"addObserver(): observer parameter must be an object",INVALID_DATA_PARAMETER:"notifyObserver(): data parameter is required and must be an object"}},luga.namespace=function(ns,rootObject){var parts=ns.split(".");rootObject||(rootObject=window);for(var i=0;i<parts.length;i++)rootObject[parts[i]]||(rootObject[parts[i]]={}),rootObject=rootObject[parts[i]];return rootObject},luga.extend=function(baseFunc,func,args){baseFunc.apply(func,args)},luga.lookup=function(reference){if(!reference)return null;if(jQuery.isFunction(reference))return reference;for(var object=window,parts=reference.split(".");parts.length>0;){var part=parts.shift();if(!(part in object))return null;object=object[part]}return jQuery.isFunction(object)?object:null},luga.merge=function(target,obj){jQuery.extend(target,obj)},luga.Notifier=function(){if(this.constructor===luga.Notifier)throw luga.CONST.ERROR_MESSAGES.NOTIFIER_ABSTRACT;this.observers=[];var prefix="on",suffix="Handler",generateMethodName=function(eventName){var str=prefix;return str+=eventName.charAt(0).toUpperCase(),str+=eventName.substring(1),str+=suffix};this.addObserver=function(observer){if("object"!==jQuery.type(observer))throw luga.CONST.ERROR_MESSAGES.INVALID_OBSERVER_PARAMETER;this.observers.push(observer)},this.notifyObservers=function(eventName,data){if("object"!==jQuery.type(data))throw luga.CONST.ERROR_MESSAGES.INVALID_DATA_PARAMETER;for(var method=generateMethodName(eventName),i=0;i<this.observers.length;i++){var observer=this.observers[i];observer[method]&&jQuery.isFunction(observer[method])&&observer[method](data)}},this.removeObserver=function(observer){for(var i=0;i<this.observers.length;i++)if(this.observers[i]===observer){this.observers.splice(i,1);break}}},luga.namespace("luga.form"),luga.namespace("luga.form.utils"),luga.form.CONST={FIELD_SELECTOR:"input,select,textarea",FAKE_INPUT_TYPES:{fieldset:!0,reset:!0},MESSAGES:{FORM_MISSING:"Unable to load form"},HASH_DELIMITER:","},luga.form.toQueryString=function(formNode,demoronize){if(0===formNode.length)throw luga.form.CONST.MESSAGES.FORM_MISSING;for(var str="",fields=luga.form.utils.getChildFields(formNode),i=0;i<fields.length;i++)if(luga.form.utils.isSuccessfulField(fields[i])===!0){var fieldName=jQuery(fields[i]).attr("name"),fieldValue=jQuery(fields[i]).val();if(jQuery.isArray(fieldValue)===!0)for(var j=0;j<fieldValue.length;j++)str=appendQueryString(str,fieldName,fieldValue[j],demoronize);else str=appendQueryString(str,fieldName,fieldValue,demoronize)}return str};var appendQueryString=function(str,fieldName,fieldValue,demoronize){return""!==str&&(str+="&"),str+=encodeURIComponent(fieldName),str+="=",str+=demoronize===!0?encodeURIComponent(luga.string.demoronize(fieldValue)):encodeURIComponent(fieldValue)};luga.form.toHash=function(formNode,demoronize){if(0===formNode.length)throw luga.form.CONST.MESSAGES.FORM_MISSING;for(var map={},fields=luga.form.utils.getChildFields(formNode),i=0;i<fields.length;i++)if(luga.form.utils.isSuccessfulField(fields[i])===!0){var fieldName=jQuery(fields[i]).attr("name"),fieldValue=jQuery(fields[i]).val();jQuery.isArray(fieldValue)===!0&&(fieldValue=fieldValue.join(luga.form.CONST.HASH_DELIMITER)),demoronize===!0&&(fieldValue=luga.string.demoronize(fieldValue)),void 0===map[fieldName]?map[fieldName]=fieldValue:map[fieldName]+=luga.form.CONST.HASH_DELIMITER+fieldValue}return map},luga.form.utils.isSuccessfulField=function(fieldNode){return luga.form.utils.isInputField(fieldNode)===!1?!1:void 0===jQuery(fieldNode).attr("name")?!1:!0},luga.form.utils.isInputField=function(fieldNode){return jQuery(fieldNode).prop("type")?luga.form.CONST.FAKE_INPUT_TYPES[jQuery(fieldNode).prop("type")]===!0?!1:!0:!1},luga.form.utils.getFieldGroup=function(name,formNode){var selector="input[name="+name+"]";return jQuery(selector,formNode)},luga.form.utils.getChildFields=function(rootNode){var fields=[];return jQuery(rootNode).find(luga.form.CONST.FIELD_SELECTOR).each(function(index,item){luga.form.utils.isInputField(item)&&fields.push(item)}),fields},luga.namespace("luga.string"),luga.string.format=function(str,args){var pattern=null;if($.isArray(args))for(var i=0;i<args.length;i++)pattern=new RegExp("\\{"+i+"\\}","g"),str=str.replace(pattern,args[i]);if($.isPlainObject(args))for(var x in args)pattern=new RegExp("\\{"+x+"\\}","g"),str=str.replace(pattern,args[x]);return str},luga.string.demoronize=function(str){return str=str.replace(new RegExp(String.fromCharCode(710),"g"),"^"),str=str.replace(new RegExp(String.fromCharCode(732),"g"),"~"),str=str.replace(new RegExp(String.fromCharCode(8216),"g"),"'"),str=str.replace(new RegExp(String.fromCharCode(8217),"g"),"'"),str=str.replace(new RegExp(String.fromCharCode(8220),"g"),'"'),str=str.replace(new RegExp(String.fromCharCode(8221),"g"),'"'),str=str.replace(new RegExp(String.fromCharCode(8211),"g"),"-"),str=str.replace(new RegExp(String.fromCharCode(8212),"g"),"--"),str=str.replace(new RegExp(String.fromCharCode(8218),"g"),","),str=str.replace(new RegExp(String.fromCharCode(8222),"g"),",,"),str=str.replace(new RegExp(String.fromCharCode(8226),"g"),"*"),str=str.replace(new RegExp(String.fromCharCode(8230),"g"),"...")},luga.namespace("luga.utils"),luga.utils.CONST={CSS_CLASSES:{MESSAGE:"luga_message",ERROR_MESSAGE:"luga_error_message"},MSG_BOX_ID:"lugaMessageBox"};var generateBoxId=function(node){var boxId=luga.utils.CONST.MSG_BOX_ID;return node.attr("id")?boxId+=node.attr("id"):node.attr("name")&&(boxId+=node.attr("name")),boxId};luga.utils.removeDisplayBox=function(node){var boxId=generateBoxId(jQuery(node)),oldBox=jQuery("#"+boxId);oldBox.length>0&&oldBox.remove()},luga.utils.displayMessage=function(node,html){return luga.utils.displayBox(node,html,luga.utils.CONST.CSS_CLASSES.MESSAGE)},luga.utils.displayErrorMessage=function(node,html){return luga.utils.displayBox(node,html,luga.utils.CONST.CSS_CLASSES.ERROR_MESSAGE)},luga.utils.displayBox=function(node,html,cssClass){cssClass||(cssClass=luga.utils.CONST.CSS_CLASSES.MESSAGE);var boxId=generateBoxId(jQuery(node)),box=jQuery("<div></div>");box.attr("id",boxId),box.addClass(cssClass),box.html(html);var oldBox=jQuery("#"+boxId);return oldBox.length>0?oldBox.replaceWith(box):jQuery(node).before(box),box}}();