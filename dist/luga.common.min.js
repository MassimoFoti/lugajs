/*! 
Luga Common 0.9.7 2018-03-31T22:48:59.819Z
http://www.lugajs.org
Copyright 2013-2018 Massimo Foti (massimo@massimocorner.com)
Licensed under the Apache License, Version 2.0 | http://www.apache.org/licenses/LICENSE-2.0
 */
if("undefined"==typeof jQuery)throw"Unable to find jQuery";"undefined"==typeof luga&&(window.luga={}),function(){"use strict";luga.namespace=function(ns,rootObject){var parts=ns.split(".");void 0===rootObject&&(rootObject=window);for(var i=0;i<parts.length;i++)void 0===rootObject[parts[i]]&&(rootObject[parts[i]]={}),rootObject=rootObject[parts[i]];return rootObject},luga.namespace("luga.common"),luga.common.version="0.9.7",luga.extend=function(baseFunc,func,args){baseFunc.apply(func,args)},luga.isPlainObject=function(obj){if("[object Object]"!==Object.prototype.toString.call(obj))return!1;var proto=Object.getPrototypeOf(obj);if(null===proto)return!0;var constructor=Object.prototype.hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof("function"===constructor)&&Function.toString.call(constructor)===Function.toString.call(Object)},luga.lookupFunction=function(path){if(path){var reference=luga.lookupProperty(window,path);return"function"===luga.type(reference)?reference:void 0}},luga.lookupProperty=function(object,path){if(object&&path){if(void 0!==object[path])return object[path];for(var parts=path.split(".");parts.length>0;){var part=parts.shift();if(void 0!==object[part]){if(0===parts.length)return object[part];object=object[part]}}}},luga.merge=function(target,source){for(var x in source)!0===source.hasOwnProperty(x)&&(target[x]=source[x])},luga.setProperty=function(object,path,value){var parts=path.split(".");for(1===parts.length&&(object[path]=value);parts.length>0;){var part=parts.shift();if(void 0!==object[part]){if(0===parts.length){object[part]=value;break}object=object[part]}else parts.length>0?(object[part]={},object=object[part]):object[part]=value}};var class2type={};["Array","Boolean","Date","Error","Function","Number","Object","RegExp","String","Symbol"].forEach(function(element,i,collection){class2type["[object "+element+"]"]=element.toLowerCase()}),luga.type=function(obj){if(null===obj)return"null";var rawType=typeof obj;if("object"===rawType||"function"===rawType){var stringType=Object.prototype.toString.call(obj);return class2type[stringType]}return rawType},luga.NOTIFIER_CONST={ERROR_MESSAGES:{NOTIFIER_ABSTRACT:"It's forbidden to use luga.Notifier directly, it must be used as a base class instead",INVALID_GENERIC_OBSERVER_PARAMETER:"addObserver(): observer parameter must be an object",INVALID_EVENT_OBSERVER_PARAMETER:"addObserver(): eventName and methodName must be strings",INVALID_DATA_PARAMETER:"notifyObserver(): data parameter is required and must be an object"}},luga.Notifier=function(){if(this.constructor===luga.Notifier)throw luga.NOTIFIER_CONST.ERROR_MESSAGES.NOTIFIER_ABSTRACT;this.observers=[],this.eventObservers={};this.addObserver=function(observer,eventName,methodName){if("object"!==luga.type(observer))throw luga.NOTIFIER_CONST.ERROR_MESSAGES.INVALID_GENERIC_OBSERVER_PARAMETER;if(1===arguments.length&&this.observers.push(observer),3===arguments.length){if("string"!==luga.type(eventName)||"string"!==luga.type(methodName))throw luga.NOTIFIER_CONST.ERROR_MESSAGES.INVALID_EVENT_OBSERVER_PARAMETER;var eventMap={observer:observer,methodName:methodName};void 0===this.eventObservers[eventName]?this.eventObservers[eventName]=[eventMap]:-1===findObserverIndex(this.eventObservers[eventName],eventMap)&&this.eventObservers[eventName].push(eventMap)}};var findObserverIndex=function(eventArray,eventMap){for(var i=0;i<eventArray.length;i++){var currentMap=eventArray[i];if(currentMap.observer===eventMap.observer&&currentMap.methodName===eventMap.methodName)return i}return-1};this.notifyObservers=function(eventName,payload){if("object"!==luga.type(payload))throw luga.NOTIFIER_CONST.ERROR_MESSAGES.INVALID_DATA_PARAMETER;var genericMethod=function(eventName){var str="on";return str+=eventName.charAt(0).toUpperCase(),str+=eventName.substring(1),str+="Handler"}(eventName);this.observers.forEach(function(element,i,collection){void 0!==element[genericMethod]&&"function"===luga.type(element[genericMethod])&&element[genericMethod](payload)});var eventObservers=this.eventObservers[eventName];void 0!==eventObservers&&eventObservers.forEach(function(element,i,collection){"function"===luga.type(element.observer[element.methodName])&&element.observer[element.methodName](payload)})},this.removeObserver=function(observer,eventName,methodName){if(1===arguments.length)for(var i=0;i<this.observers.length;i++)if(this.observers[i]===observer){this.observers.splice(i,1);break}if(3===arguments.length&&void 0!==this.eventObservers[eventName]){var eventMap={observer:observer,methodName:methodName},index=findObserverIndex(this.eventObservers[eventName],eventMap);-1!==index&&(this.eventObservers[eventName].splice(index,1),0===this.eventObservers[eventName].length&&delete this.eventObservers[eventName])}}},luga.namespace("luga.dom"),luga.dom.ready=function(fn){document.addEventListener("DOMContentLoaded",fn)};var getIteratorInstance=function(type,rootNode,filterFunc){var filter_acceptNode=function(node){return void 0!==filterFunc&&!1===filterFunc(node)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},safeFilter=filter_acceptNode;return safeFilter.acceptNode=filter_acceptNode,"TreeWalker"===type?document.createTreeWalker(rootNode,NodeFilter.SHOW_ELEMENT,safeFilter,!1):document.createNodeIterator(rootNode,NodeFilter.SHOW_ELEMENT,safeFilter,!1)};luga.namespace("luga.dom.nodeIterator"),luga.dom.nodeIterator.getInstance=function(rootNode,filterFunc){return getIteratorInstance("NodeIterator",rootNode,filterFunc)},luga.namespace("luga.dom.treeWalker"),luga.dom.treeWalker.getInstance=function(rootNode,filterFunc){return getIteratorInstance("TreeWalker",rootNode,filterFunc)},luga.namespace("luga.form"),luga.form.CONST={FIELD_SELECTOR:"input,select,textarea",FAKE_INPUT_TYPES:{fieldset:!0,reset:!0},MESSAGES:{MISSING_FORM:"Unable to load form"}},luga.form.toMap=function(rootNode,demoronize){if(0===rootNode.length)throw luga.form.CONST.MESSAGES.MISSING_FORM;for(var map={},fields=luga.form.utils.getChildFields(rootNode),i=0;i<fields.length;i++)if(!0===luga.form.utils.isSuccessfulField(fields[i])){var fieldName=jQuery(fields[i]).attr("name"),fieldValue=null;switch(jQuery(fields[i]).prop("type")){case"select-multiple":fieldValue=jQuery(fields[i]).val();break;case"checkbox":case"radio":!0===jQuery(fields[i]).prop("checked")&&(fieldValue=jQuery(fields[i]).val());break;default:fieldValue=jQuery(fields[i]).val()}null!==fieldValue&&(!0===demoronize&&(fieldValue=luga.string.demoronize(fieldValue)),void 0===map[fieldName]?map[fieldName]=fieldValue:!0===Array.isArray(map[fieldName])?map[fieldName].push(fieldValue):map[fieldName]=[map[fieldName],fieldValue])}return map},luga.form.toJson=function(rootNode){var flatData=luga.form.toMap(rootNode),jsonData={};for(var x in flatData)luga.setProperty(jsonData,x,flatData[x]);return jsonData},luga.form.toQueryString=function(rootNode,demoronize){if(0===rootNode.length)throw luga.form.CONST.MESSAGES.MISSING_FORM;for(var str="",fields=luga.form.utils.getChildFields(rootNode),i=0;i<fields.length;i++)if(!0===luga.form.utils.isSuccessfulField(fields[i])){var fieldName=jQuery(fields[i]).attr("name"),fieldValue=jQuery(fields[i]).val();switch(jQuery(fields[i]).prop("type")){case"select-multiple":for(var j=0;j<fieldValue.length;j++)str=appendQueryString(str,fieldName,fieldValue[j],demoronize);break;case"checkbox":case"radio":!0===jQuery(fields[i]).prop("checked")&&(str=appendQueryString(str,fieldName,fieldValue,demoronize));break;default:str=appendQueryString(str,fieldName,fieldValue,demoronize)}}return str};var appendQueryString=function(str,fieldName,fieldValue,demoronize){return""!==str&&(str+="&"),str+=encodeURIComponent(fieldName),str+="=",str+=!0===demoronize?encodeURIComponent(luga.string.demoronize(fieldValue)):encodeURIComponent(fieldValue)};luga.namespace("luga.form.utils"),luga.form.utils.isSuccessfulField=function(fieldNode){return!1!==luga.form.utils.isInputField(fieldNode)&&(!0!==jQuery(fieldNode).prop("disabled")&&void 0!==jQuery(fieldNode).attr("name"))},luga.form.utils.isInputField=function(fieldNode){return void 0!==jQuery(fieldNode).prop("type")&&!0!==luga.form.CONST.FAKE_INPUT_TYPES[jQuery(fieldNode).prop("type")]},luga.form.utils.getFieldGroup=function(name,rootNode){return jQuery("input[name='"+name+"']",rootNode)},luga.form.utils.getChildFields=function(rootNode){var fields=[];return jQuery(rootNode).find(luga.form.CONST.FIELD_SELECTOR).each(function(index,item){luga.form.utils.isInputField(item)&&fields.push(item)}),fields},luga.namespace("luga.localStorage"),luga.localStorage.retrieve=function(root,path){return luga.lookupProperty(getRootState(root),path.toString())},luga.localStorage.persist=function(root,path,value){var json=getRootState(root);luga.setProperty(json,path.toString(),value),setRootState(root,json)};var setRootState=function(root,json){localStorage.setItem(root,JSON.stringify(json))},getRootState=function(root){var rootJson=localStorage.getItem(root);return null===rootJson?{}:JSON.parse(rootJson)};luga.namespace("luga.string"),luga.string.demoronize=function(str){return str=(str=(str=(str=(str=(str=(str=(str=(str=(str=(str=(str=str.replace(new RegExp(String.fromCharCode(710),"g"),"^")).replace(new RegExp(String.fromCharCode(732),"g"),"~")).replace(new RegExp(String.fromCharCode(8216),"g"),"'")).replace(new RegExp(String.fromCharCode(8217),"g"),"'")).replace(new RegExp(String.fromCharCode(8220),"g"),'"')).replace(new RegExp(String.fromCharCode(8221),"g"),'"')).replace(new RegExp(String.fromCharCode(8211),"g"),"-")).replace(new RegExp(String.fromCharCode(8212),"g"),"--")).replace(new RegExp(String.fromCharCode(8218),"g"),",")).replace(new RegExp(String.fromCharCode(8222),"g"),",,")).replace(new RegExp(String.fromCharCode(8226),"g"),"*")).replace(new RegExp(String.fromCharCode(8230),"g"),"...")},luga.string.format=function(str,args){var pattern=null;if(!0===Array.isArray(args))for(var i=0;i<args.length;i++)pattern=new RegExp("\\{"+i+"\\}","g"),str=str.replace(pattern,args[i]);if(!0===luga.isPlainObject(args))for(var x in args)pattern=new RegExp("\\{"+x+"\\}","g"),str=str.replace(pattern,args[x]);return str},luga.string.queryToMap=function(str){var map={};if("?"===str.charAt(0)&&(str=str.substring(1)),0===str.length)return map;for(var parts=str.split("&"),i=0;i<parts.length;i++){var tokens=parts[i].split("="),fieldName=decodeURIComponent(tokens[0]),fieldValue="";2===tokens.length&&(fieldValue=decodeURIComponent(tokens[1])),void 0===map[fieldName]?map[fieldName]=fieldValue:!0===Array.isArray(map[fieldName])?map[fieldName].push(fieldValue):map[fieldName]=[map[fieldName],fieldValue]}return map};var propertyPattern=new RegExp("\\{([^}]*)}","g");luga.string.populate=function(str,obj){if(!0===luga.isPlainObject(obj))for(var results;null!==(results=propertyPattern.exec(str));){var property=luga.lookupProperty(obj,results[1]);if(void 0!==property){var pattern=new RegExp(results[0],"g");str=str.replace(pattern,property),propertyPattern.test(str)}}return str},luga.namespace("luga.utils"),luga.utils.CONST={CSS_CLASSES:{MESSAGE:"luga-message",ERROR_MESSAGE:"luga-error-message"},MSG_BOX_ID:"lugaMessageBox"};var generateBoxId=function(node){var boxId=luga.utils.CONST.MSG_BOX_ID;return void 0===node.attr("id")?boxId+=node.attr("id"):void 0!==node.attr("name")&&(boxId+=node.attr("name")),boxId};luga.utils.removeDisplayBox=function(node){var boxId=generateBoxId(jQuery(node)),oldBox=jQuery("#"+boxId);oldBox.length>0&&oldBox.remove()},luga.utils.displayMessage=function(node,html){return luga.utils.displayBox(node,html,luga.utils.CONST.CSS_CLASSES.MESSAGE)},luga.utils.displayErrorMessage=function(node,html){return luga.utils.displayBox(node,html,luga.utils.CONST.CSS_CLASSES.ERROR_MESSAGE)},luga.utils.displayBox=function(node,html,cssClass){void 0===cssClass&&(cssClass=luga.utils.CONST.CSS_CLASSES.MESSAGE);var boxId=generateBoxId(jQuery(node)),box=jQuery("<div></div>");box.attr("id",boxId),box.addClass(cssClass),box.html(html);var oldBox=jQuery("#"+boxId);return oldBox.length>0?oldBox.replaceWith(box):jQuery(node).before(box),box},luga.namespace("luga.xhr"),luga.XHR_CONST={POST_CONTENT_TYPE:"application/x-www-form-urlencoded"},luga.xhr.Request=function(options){var config={method:"GET",success:function(res){console.debug(res)},error:function(res){console.debug(res)},timeout:5e3,async:!0,cache:!0,headers:[],requestedWith:"XMLHttpRequest",contentType:"text/plain"};void 0!==options&&luga.merge(config,options),"POST"===config.method.toUpperCase()&&(config.contentType=luga.XHR_CONST.POST_CONTENT_TYPE);var self=this;self.xhr=new XMLHttpRequest;var assembleResponse=function(){return{status:self.xhr.status,statusText:self.xhr.statusText,responseText:self.xhr.responseText,responseType:self.xhr.responseType,responseXML:self.xhr.responseXML,headers:(str=self.xhr.getAllResponseHeaders(),headers=str.split("\r\n"),headers.pop(),headers.map(function(item){var tokens=item.split(":");return{header:tokens[0],value:tokens[1].substring(1)}}))};var str,headers},checkReadyState=function(){if(4===self.xhr.readyState){var httpStatus=self.xhr.status;httpStatus>=200&&httpStatus<=300||304===httpStatus?config.success(assembleResponse()):config.error(assembleResponse())}};this.abort=function(){self.xhr.abort()},this.isRequestPending=function(){return 4!==self.xhr.readyState},this.send=function(url,params){void 0===params&&(params=null),url=function(url,params){var suffix="";return!1===config.cache&&(suffix+="_anti-cache="+Date.now()+"&"),null!==params&&"GET"===config.method.toUpperCase()&&(suffix+=params),""!==suffix&&(-1!==url.indexOf("?")?url+="&":url+="?"),url+suffix}(url,params),self.xhr.open(config.method,url,config.async),function(url){self.xhr.onreadystatechange=checkReadyState,self.xhr.timeout=config.timeout,self.xhr.setRequestHeader("Content-Type",config.contentType),"http"!==url.substring(0,4)&&self.xhr.setRequestHeader("X-Requested-With",config.requestedWith),config.headers.forEach(function(item){self.xhr.setRequestHeader(item.name,item.value)})}(url),self.xhr.send(params)}}}();
//# sourceMappingURL=luga.common.min.js.map
