/*! Luga Ajaxform 0.7.0 2015-10-30 14:10
Copyright 2013-15 Massimo Foti (massimo@massimocorner.com) 
Licensed under the Apache License, Version 2.0 | http://www.apache.org/licenses/LICENSE-2.0 
*/

if("undefined"==typeof luga)throw"Unable to find Luga JS Core";!function(){"use strict";luga.namespace("luga.ajaxform"),luga.ajaxform.version="0.7.0",luga.namespace("luga.ajaxform.handlers"),luga.ajaxform.handlers.replaceForm=function(msg,formNode,textStatus,jqXHR){jQuery(formNode).empty(),jQuery(formNode).html(msg)},luga.ajaxform.handlers.errorAlert=function(msg,formNode,textStatus,errorThrown,jqXHR){alert(msg)},luga.ajaxform.handlers.errorBox=function(msg,formNode,textStatus,errorThrown,jqXHR){luga.utils.removeDisplayBox(formNode),luga.utils.displayErrorMessage(formNode,msg)},luga.ajaxform.CONST={FORM_SELECTOR:"form[data-lugajax-form='true']",USER_AGENT:"luga.ajaxform",DEFAULT_METHOD:"GET",DEFAULT_TIME_OUT:3e4,CUSTOM_ATTRIBUTES:{AJAX:"data-lugajax-form",ACTION:"data-lugajax-action",METHOD:"data-lugajax-method",TIME_OUT:"data-lugajax-timeout",SUCCESS:"data-lugajax-success",SUCCESS_MSG:"data-lugajax-successmsg",ERROR:"data-lugajax-error",ERROR_MSG:"data-lugajax-errormsg",BEFORE:"data-lugajax-before",AFTER:"data-lugajax-after"},MESSAGES:{SUCCESS:"Thanks for submitting the form",ERROR:"Failed to submit the form",MISSING_FORM:"luga.ajaxform was unable to load form",MISSING_FUNCTION:"luga.ajaxform was unable to find a function named: {0}"},HANDLERS:{SUCCESS:"luga.ajaxform.handlers.replaceForm",ERROR:"luga.ajaxform.handlers.errorAlert"}},luga.ajaxform.Sender=function(options){options.formNode=jQuery(options.formNode),this.config={action:options.formNode.attr("action")||options.formNode.attr(luga.ajaxform.CONST.CUSTOM_ATTRIBUTES.ACTION)||document.location.href,method:options.formNode.attr("method")||options.formNode.attr(luga.ajaxform.CONST.CUSTOM_ATTRIBUTES.METHOD)||luga.ajaxform.CONST.DEFAULT_METHOD,timeout:options.formNode.attr(luga.ajaxform.CONST.CUSTOM_ATTRIBUTES.TIME_OUT)||luga.ajaxform.CONST.DEFAULT_TIME_OUT,success:options.formNode.attr(luga.ajaxform.CONST.CUSTOM_ATTRIBUTES.SUCCESS)||luga.ajaxform.CONST.HANDLERS.SUCCESS,error:options.formNode.attr(luga.ajaxform.CONST.CUSTOM_ATTRIBUTES.ERROR)||luga.ajaxform.CONST.HANDLERS.ERROR,successmsg:options.formNode.attr(luga.ajaxform.CONST.CUSTOM_ATTRIBUTES.SUCCESS_MSG)||luga.ajaxform.CONST.MESSAGES.SUCCESS,errormsg:options.formNode.attr(luga.ajaxform.CONST.CUSTOM_ATTRIBUTES.ERROR_MSG)||luga.ajaxform.CONST.MESSAGES.ERROR,before:options.formNode.attr(luga.ajaxform.CONST.CUSTOM_ATTRIBUTES.BEFORE)||null,after:options.formNode.attr(luga.ajaxform.CONST.CUSTOM_ATTRIBUTES.AFTER)||null},luga.merge(this.config,options),this.config.timeout=parseInt(this.config.timeout,10);var self=this;if(0===self.config.formNode.length)throw luga.ajaxform.CONST.MESSAGES.MISSING_FORM;var handleAfter=function(){if(null!==self.config.after){var callBack=luga.lookup(self.config.after);if(null===callBack)throw luga.string.format(luga.ajaxform.CONST.MESSAGES.MISSING_FUNCTION,[self.config.after]);callBack.apply(null,[self.config.formNode])}},handleBefore=function(){if(null!==self.config.before){var callBack=luga.lookup(self.config.before);if(null===callBack)throw luga.string.format(luga.ajaxform.CONST.MESSAGES.MISSING_FUNCTION,[self.config.before]);callBack.apply(null,[self.config.formNode])}},handleError=function(textStatus,jqXHR,errorThrown){var callBack=luga.lookup(self.config.error);if(null===callBack)throw luga.string.format(luga.ajaxform.CONST.MESSAGES.MISSING_FUNCTION,[self.config.error]);callBack.apply(null,[self.config.errormsg,self.config.formNode,textStatus,errorThrown,jqXHR])},handleSuccess=function(textStatus,jqXHR){var callBack=luga.lookup(self.config.success);if(null===callBack)throw luga.string.format(luga.ajaxform.CONST.MESSAGES.MISSING_FUNCTION,[self.config.success]);callBack.apply(null,[self.config.successmsg,self.config.formNode,textStatus,jqXHR])};this.send=function(){var formData=luga.form.toQueryString(self.config.formNode,!0);null!==self.config.before&&handleBefore(),jQuery.ajax({data:formData,headers:{"X-Requested-With":luga.ajaxform.CONST.USER_AGENT},error:function(jqXHR,textStatus,errorThrown){handleError(textStatus,jqXHR,errorThrown)},method:self.config.method,success:function(response,textStatus,jqXHR){handleSuccess(textStatus,jqXHR)},timeout:self.config.timeout,url:self.config.action}),null!==self.config.after&&handleAfter()},this.sendJson=function(){var formData=luga.form.toHash(self.config.formNode,!0);null!==self.config.before&&handleBefore(),jQuery.ajax({contentType:"application/json",data:JSON.stringify(formData),headers:{"X-Requested-With":luga.ajaxform.CONST.USER_AGENT},error:function(jqXHR,textStatus,errorThrown){handleError(textStatus,jqXHR,errorThrown)},method:self.config.method,success:function(response,textStatus,jqXHR){handleSuccess(textStatus,jqXHR)},timeout:self.config.timeout,url:self.config.action}),null!==self.config.after&&handleAfter()}},luga.ajaxform.initForms=function(){jQuery(luga.ajaxform.CONST.FORM_SELECTOR).each(function(index,item){var formNode=jQuery(item);formNode.submit(function(event){event.preventDefault();var formHandler=new luga.ajaxform.Sender({formNode:formNode});formHandler.send()})})},jQuery(document).ready(function(){luga.ajaxform.initForms()})}();
//# sourceMappingURL=luga.ajaxform.min.js.map